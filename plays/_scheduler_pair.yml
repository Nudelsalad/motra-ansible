---
# Run attack-first then heavy-load for the same scheduler entry when attack=true,
# otherwise run heavy-load only for 300s (5 minutes).

- name: Attack pass for {{ run.scheduler }} (only when attack=true)
  include_role:
    name: sched-test
  vars:
    sched_test_scheduler: "{{ run.scheduler }}"
    sched_test_attack: true
    sched_test_heavy_load: false
    sched_test_attack_duration: "{{ run.duration }}"
    sched_test_attack_delegate: "raspiclient"
  when: run.attack | bool

- name: Heavy-load pass for {{ run.scheduler }} paired with attack (same duration)
  include_role:
    name: sched-test
  vars:
    sched_test_scheduler: "{{ run.scheduler }}"
    sched_test_attack: false
    sched_test_heavy_load: true
    sched_test_heavy_load_duration: "{{ run.duration }}"
    sched_test_attack_delegate: "raspiclient"
  when: run.attack | bool

- name: Heavy-load only for {{ run.scheduler }} (5 minutes) when attack=false
  include_role:
    name: sched-test
  vars:
    sched_test_scheduler: "{{ run.scheduler }}"
    sched_test_attack: false
    sched_test_heavy_load: true
    sched_test_heavy_load_duration: 300
    sched_test_attack_delegate: "raspiclient"
  when: not (run.attack | bool)
